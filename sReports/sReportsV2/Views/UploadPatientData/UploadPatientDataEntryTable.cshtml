@using sReportsV2.Common.Constants;
@using sReportsV2.Common.Extensions;
@using sReportsV2.DTOs.DTOs.UploadPatientData.DataOut;
@using sReportsV2.DTOs.DTOs.UploadPatientData.DataIn;

@model sReportsV2.DTOs.Pagination.PaginationDataOut<UploadPatientDataOut, UploadPatientFilterDataIn>

@{
    var userCookieData = ViewBag.UserCookieData;
    string activeLanguage = userCookieData.ActiveLanguage;
    bool hasCreateUpdatePerm = userCookieData.UserHasPermission(PermissionNames.Update, ModuleNames.Administration);
}

<div class="table-responsive overflow-unset">
    <table class="table table-striped table-border table-layout-fixed">
        <thead class="color-header">
            <tr class="table-header-row">
                <th id="NameGiven" class="sort-arrow pl-40" style="border-bottom: unset;border-top: unset;" onclick="sortTable('NameGiven')">@sReportsV2.Cache.Resources.TextLanguage.Given.ToUpper()</th>
                <th id="NameFamily" class="sort-arrow" style="border-bottom: unset;border-top: unset;" onclick="sortTable('NameFamily')">@sReportsV2.Cache.Resources.TextLanguage.Family.ToUpper()</th>
                <th id="EntryDatetime" class="sort-arrow" style="border-bottom: unset;border-top: unset;" onclick="sortTable('EntryDatetime')">@sReportsV2.Cache.Resources.TextLanguage.Created_on.ToUpper()</th>
                <th style="border-bottom: unset;border-top: unset;"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (UploadPatientDataOut entry in Model.Data)
            {
                int uploadPatientEntryId = entry.UploadPatientDataId;
                <tr id="row-@entry.UploadPatientDataId"
                    class="table-content-row">
                    <td class="pl-40">@entry.CreatedBy.FirstName</td>
                    <td>@entry.CreatedBy.LastName</td>
                    <td>@entry.EntryDatetime.ToTimeZoned(ViewBag.DateFormat as string)</td>

                    <td>
                        @{
                            bool hasViewPerm = userCookieData.UserHasPermission(PermissionNames.View, ModuleNames.Patients);
                        }

                        @if (hasViewPerm)
                        {
                            <div>
                                <div class="dropdown">
                                    <a class="dropdown-button" href="#" data-toggle="dropdown" role="button" id="dropdownMenuButton-@uploadPatientEntryId" aria-haspopup="true" aria-expanded="false" data-display="static">
                                        <img alt="" class="dots" src="/css/img/icons/3dots.png">
                                    </a>
                                    <div class="dropdown-menu  dropdown-menu-right dropleft mr-3 mt-3" aria-labelledby="dropdownMenuButton-@uploadPatientEntryId">
                                        @if (hasViewPerm)
                                        {
                                            <a class="dropdown-item" href="#" onclick="downloadEntity(event,'@entry.UploadPath')"><img alt="" class="edit-svg-size" src="/css/img/icons/info_grey.svg">@sReportsV2.Cache.Resources.TextLanguage.Download</a>
                                        }
                                        @if (hasCreateUpdatePerm)
                                        {
                                            <a class="dropdown-item" href="#" onclick="proceedLLM(event,'@uploadPatientEntryId')"><img alt="" class="edit-svg-size" src="/css/img/icons/edit.svg">@sReportsV2.Cache.Resources.TextLanguage.Proceed LLM</a>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
    @if (Model.Data.Count == 0)
    {
        @await Html.PartialAsync("NoResultFound")
    }
    @if (Model.Data.Count > 0)
    {
        <div class="pager-container">
            @await Html.PartialAsync("Pagination")
        </div>
    }
</div>

<div class="modal fade " id="llmPreviewModal" tabindex="-1" role="dialog" aria-labelledby="llmPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="float-right filter-close-btn">
                <img alt="" class="close-modal" src="/css/img/icons/close_black.svg">
            </div>
            <div id="llm-modal-body" class="modal-body pl-5 pr-5">
            </div>

        </div>
    </div>
</div>